# Doxygen Documentation Guide

This project uses Doxygen for automatic API documentation generation from source code comments.

## Quick Start

### Generate Documentation Locally

```bash
# Install Doxygen
sudo apt-get install doxygen graphviz  # Ubuntu/Debian
brew install doxygen graphviz          # macOS

# Generate documentation
doxygen Doxyfile

# View documentation
open docs/doxygen/html/index.html    # macOS
xdg-open docs/doxygen/html/index.html  # Linux
```

### Automated Generation

Documentation is automatically generated by CI/CD pipeline on every push to main branch.
Download from GitHub Actions artifacts.

## Writing Documentation Comments

### File Header

```cpp
/**
 * @file config_manager.h
 * @brief Configuration management for thermostat settings
 * @author Your Name
 * @date 2024-11-10
 *
 * This file provides persistent storage and retrieval of thermostat
 * configuration including WiFi, MQTT, KNX, and PID parameters.
 */
```

### Class Documentation

```cpp
/**
 * @class ConfigManager
 * @brief Manages persistent configuration storage using ESP32 Preferences
 *
 * This singleton class handles all configuration storage and retrieval.
 * It uses the ESP32 Preferences library to store settings in non-volatile
 * flash memory.
 *
 * @note This is a singleton - use getInstance() to access
 *
 * Example usage:
 * @code
 * ConfigManager* config = ConfigManager::getInstance();
 * config->setWifiSSID("MyNetwork");
 * String ssid = config->getWifiSSID();
 * @endcode
 */
class ConfigManager {
    // ...
};
```

### Function Documentation

```cpp
/**
 * @brief Set the WiFi SSID for network connection
 *
 * Stores the WiFi network name in persistent storage. The SSID is
 * validated to be non-empty and less than 32 characters.
 *
 * @param ssid Network name (max 32 characters)
 *
 * @note Changes take effect after reboot
 * @see getWifiSSID(), setWifiPassword()
 *
 * @warning Do not include passwords in SSID names
 */
void setWifiSSID(const String& ssid);
```

### Parameter Documentation

```cpp
/**
 * @brief Calculate valve position using PID algorithm
 *
 * @param[in] currentTemp Current measured temperature in °C
 * @param[in] setpoint Desired temperature in °C
 * @param[out] valvePosition Calculated valve position (0-100%)
 *
 * @return true if calculation succeeded, false on error
 *
 * @retval true Successfully calculated valve position
 * @retval false Invalid input parameters
 */
bool calculateValvePosition(float currentTemp, float setpoint, int& valvePosition);
```

### Enumerations

```cpp
/**
 * @enum LogLevel
 * @brief Logging severity levels
 *
 * Defines the severity of log messages for filtering.
 */
enum LogLevel {
    LOG_NONE = 0,   ///< No logging
    LOG_ERROR,      ///< Critical errors only
    LOG_WARNING,    ///< Warnings and errors
    LOG_INFO,       ///< Informational messages
    LOG_DEBUG,      ///< Debug-level details
    LOG_VERBOSE     ///< Verbose debugging
};
```

### Constants and Macros

```cpp
/// Maximum number of WiFi connection retries
#define MAX_WIFI_RETRIES 10

/// Default MQTT broker port
static const uint16_t DEFAULT_MQTT_PORT = 1883;

/// PID controller update interval in milliseconds
static constexpr uint32_t PID_UPDATE_INTERVAL = 10000;
```

## Documentation Tags

### Common Tags

| Tag | Purpose | Example |
|-----|---------|---------|
| `@file` | File description | `@file main.cpp` |
| `@brief` | Short description | `@brief Main entry point` |
| `@param` | Parameter description | `@param temp Temperature in °C` |
| `@return` | Return value | `@return Connection status` |
| `@note` | Additional information | `@note Thread-safe` |
| `@warning` | Important warnings | `@warning May block for up to 10s` |
| `@see` | Cross-reference | `@see ConfigManager::begin()` |
| `@code` | Code example | `@code ... @endcode` |
| `@todo` | TODO items | `@todo Add input validation` |
| `@deprecated` | Deprecated features | `@deprecated Use newFunction() instead` |

### ESP32-Specific Tags

```cpp
/**
 * @platform ESP32
 * @requires WiFi, SPIFFS
 * @memory 2KB heap, 256B stack
 * @gpio Uses GPIO 21 (SDA), 22 (SCL)
 */
```

## Documentation Structure

The generated documentation includes:

### Main Page
- Project overview
- Quick start guide
- System architecture

### Modules/Groups
Group related functionality:
```cpp
/**
 * @defgroup mqtt MQTT Communication
 * @brief MQTT client and Home Assistant integration
 * @{
 */

// ... MQTT-related code ...

/** @} */ // end of mqtt group
```

### Class Hierarchy
- Inheritance diagrams
- Collaboration diagrams
- Member lists

### File Documentation
- Source file listings
- Include dependencies
- File-level functions

### Examples
- Code examples
- Use cases
- Tutorials

## Configuration

The Doxyfile includes:

- **Project Name**: ESP32 KNX Thermostat
- **Input Sources**: src/, include/, docs/
- **Output**: docs/doxygen/html/
- **Features Enabled**:
  - Source code browser
  - Class diagrams (via Graphviz)
  - Include graphs
  - Call graphs
  - Collaboration diagrams
  - Tree view navigation

## Viewing Documentation

### Local Viewing

After generating docs:
```bash
cd docs/doxygen/html
python3 -m http.server 8000
# Open http://localhost:8000 in browser
```

### CI/CD Artifacts

1. Go to GitHub Actions
2. Select successful workflow run
3. Download "documentation" artifact
4. Extract and open index.html

## Best Practices

### DO:
✅ Document all public APIs
✅ Include code examples
✅ Explain WHY, not just WHAT
✅ Document assumptions and limitations
✅ Use consistent formatting
✅ Update docs with code changes

### DON'T:
❌ Document obvious code
❌ Repeat information
❌ Use generic descriptions
❌ Include implementation details in headers
❌ Forget parameter documentation
❌ Leave TODO comments in production

## Examples

### Well-Documented Class

```cpp
/**
 * @class AdaptivePIDController
 * @brief Self-tuning PID controller for temperature regulation
 *
 * Implements a PID controller with adaptive gain adjustment based on
 * system response. Automatically tunes Kp, Ki, and Kd parameters to
 * optimize performance for the specific heating system.
 *
 * @details
 * The controller uses a modified Ziegler-Nichols method to estimate
 * system characteristics and adjust PID gains. It monitors:
 * - Rise time
 * - Overshoot percentage
 * - Settling time
 * - Steady-state error
 *
 * @note Thread-safe for concurrent access
 * @warning Requires at least 1 hour of operation for tuning
 *
 * @see PIDParameters, TuningMethod
 *
 * Example:
 * @code{.cpp}
 * AdaptivePIDController pid(2.0, 0.1, 0.5);
 * pid.setSetpoint(22.5);
 * pid.enableAutoTune(true);
 *
 * // In control loop
 * float output = pid.compute(currentTemp);
 * valve.setPosition(output);
 * @endcode
 *
 * @author ESP32 Thermostat Team
 * @date 2024-11-10
 * @version 1.0.0
 */
class AdaptivePIDController {
public:
    // ...
};
```

## Troubleshooting

### Doxygen Not Found
```bash
which doxygen  # Check if installed
doxygen --version  # Check version (need 1.8.0+)
```

### Missing Graphviz Diagrams
```bash
which dot  # Check if Graphviz installed
sudo apt-get install graphviz
```

### Documentation Not Generated
```bash
# Run with verbose output
doxygen -d Preprocessor Doxyfile

# Check warnings
doxygen Doxyfile 2>&1 | grep -i warning
```

### Broken Links
- Ensure @see references use correct syntax
- Use fully qualified names for cross-references
- Check that referenced files exist

## Integration with IDE

### VS Code

Install "Doxygen Documentation Generator" extension:
```json
// settings.json
{
    "doxdocgen.c.commentPrefix": "/// ",
    "doxdocgen.cpp.tparamTemplate": "@tparam {param} ",
    "doxdocgen.generic.authorTag": "@author Your Name"
}
```

Type `/**` above a function and press Enter to auto-generate template.

### CLion

Settings → Tools → Doxygen → Enable
Generate docs from Tools → Doxygen → Run

## Continuous Documentation

To keep documentation current:

1. **Write docs as you code** - Don't leave for later
2. **Review docs in PRs** - Check documentation coverage
3. **Auto-generate on CI** - Catch missing docs early
4. **Update examples** - Keep code examples working
5. **Version documentation** - Tag docs with releases

## Further Reading

- [Doxygen Manual](https://www.doxygen.nl/manual/)
- [Documenting C++ Code](https://developer.lsst.io/cpp/api-docs.html)
- [Google C++ Style Guide](https://google.github.io/styleguide/cppguide.html#Comments)
